# .github/workflows/ci_pipeline.yml
# Flujo de CI/CD que corre con cada cambio en la rama principal.

name: ğŸ§‘â€ğŸ’» Quality Gate y Despliegue

on:
  push:
    branches: [ main ] # Se dispara con cada cambio en la rama principal

jobs:
  build_test_deploy:
    runs-on: ubuntu-latest
    
    steps:
    
    # 1. Bajar el cÃ³digo del repositorio
    - name: ğŸ“¥ Clonar Repositorio
      uses: actions/checkout@v4
      
    # 2. Configurar Python 3.10
    - name: ğŸ Configurar Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.10'
        
    # 3. Quality Gate: Ejecutar Pruebas
    - name: ğŸš¦ Quality Gate: Ejecutar Pruebas
      # Este paso ejecuta el script de pruebas de la calculadora.
      # Se incluye el comando ls -la para diagnÃ³stico de ubicaciÃ³n.
      run: |
        echo "=========================================================="
        echo "ğŸ” DiagnÃ³stico: Listado de archivos en la raÃ­z del job (debe aparecer calculadora.py):"
        ls -la # Comando para listar el contenido del directorio
        echo "=========================================================="
        # Comando que ejecuta las pruebas. Falla si calculadora.py no existe o si las pruebas fallan.
        python calculadora.py

    # 4. Despliegue (solo si el Quality Gate fue exitoso)
    - name: ğŸš€ SimulaciÃ³n de Despliegue (CD)
      # La condiciÃ³n IF y el RUN deben estar alineados correctamente en YAML.
      if: success()
      run: |
        echo "=========================================================="
        echo "âœ… Quality Gate Aprobado. Iniciando Despliegue."
        echo "ğŸ‰ El cÃ³digo pasa a producciÃ³n."
        echo "=========================================================="
